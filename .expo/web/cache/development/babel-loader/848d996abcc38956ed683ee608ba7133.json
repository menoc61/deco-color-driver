{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { useRef, useMemo, useState, useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport useWindowDimensions from \"react-native-web/dist/exports/useWindowDimensions\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport BottomSheet, { BottomSheetFlatList } from \"@gorhom/bottom-sheet\";\nimport * as Location from \"expo-location\";\nimport OrderItem from \"../../components/OrderItem\";\nimport MapView from \"react-native-maps\";\nimport { DataStore } from \"aws-amplify\";\nimport { Order } from \"../../models\";\nimport CustomMarker from \"../../components/CustomMarker\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar OrdersScreen = function OrdersScreen() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      orders = _useState2[0],\n      setOrders = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      driverLocation = _useState4[0],\n      setDriverLocation = _useState4[1];\n\n  var bottomSheetRef = useRef(null);\n\n  var _useWindowDimensions = useWindowDimensions(),\n      width = _useWindowDimensions.width,\n      height = _useWindowDimensions.height;\n\n  var snapPoints = useMemo(function () {\n    return [\"12%\", \"95%\"];\n  }, []);\n\n  var fetchOrders = function fetchOrders() {\n    DataStore.query(Order, function (order) {\n      return order.status(\"eq\", \"READY_FOR_PICKUP\");\n    }).then(setOrders);\n  };\n\n  useEffect(function () {\n    fetchOrders();\n    var subscription = DataStore.observe(Order).subscribe(function (msg) {\n      if (msg.opType === \"UPDATE\") {\n        fetchOrders();\n      }\n    });\n    return function () {\n      return subscription.unsubscribe();\n    };\n  }, []);\n  useEffect(function () {\n    (function _callee() {\n      var _await$Location$reque, status, location;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Location.requestForegroundPermissionsAsync());\n\n            case 2:\n              _await$Location$reque = _context.sent;\n              status = _await$Location$reque.status;\n\n              if (!(!status === \"granted\")) {\n                _context.next = 7;\n                break;\n              }\n\n              console.log(\"Nonono\");\n              return _context.abrupt(\"return\");\n\n            case 7:\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync());\n\n            case 9:\n              location = _context.sent;\n              setDriverLocation({\n                latitude: location.coords.latitude,\n                longitude: location.coords.longitude\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n\n  if (!driverLocation) {\n    return _jsx(ActivityIndicator, {\n      size: \"large\",\n      color: \"gray\"\n    });\n  }\n\n  return _jsxs(View, {\n    style: {\n      backgroundColor: \"lightblue\",\n      flex: 1\n    },\n    children: [_jsx(MapView, {\n      style: {\n        height: height,\n        width: width\n      },\n      showsUserLocation: true,\n      followsUserLocation: true,\n      initialRegion: {\n        latitude: driverLocation.latitude,\n        longitude: driverLocation.longitude,\n        latitudeDelta: 0.07,\n        longitudeDelta: 0.07\n      },\n      children: orders.map(function (order) {\n        return _jsx(CustomMarker, {\n          data: order.Company,\n          type: \"COMPANY\"\n        }, order.id);\n      })\n    }), _jsxs(BottomSheet, {\n      ref: bottomSheetRef,\n      snapPoints: snapPoints,\n      children: [_jsxs(View, {\n        style: {\n          alignItems: \"center\",\n          marginBottom: 30\n        },\n        children: [_jsx(Text, {\n          style: {\n            fontSize: 20,\n            fontWeight: \"600\",\n            letterSpacing: 0.5,\n            paddingBottom: 5\n          },\n          children: \"You're Online\"\n        }), _jsxs(Text, {\n          style: {\n            letterSpacing: 0.5,\n            color: \"grey\"\n          },\n          children: [\"Available Orders: \", orders.length]\n        })]\n      }), _jsx(BottomSheetFlatList, {\n        data: orders,\n        renderItem: function renderItem(_ref) {\n          var item = _ref.item;\n          return _jsx(OrderItem, {\n            order: item\n          });\n        }\n      })]\n    })]\n  });\n};\n\nexport default OrdersScreen;","map":{"version":3,"names":["useRef","useMemo","useState","useEffect","BottomSheet","BottomSheetFlatList","Location","OrderItem","MapView","DataStore","Order","CustomMarker","OrdersScreen","orders","setOrders","driverLocation","setDriverLocation","bottomSheetRef","useWindowDimensions","width","height","snapPoints","fetchOrders","query","order","status","then","subscription","observe","subscribe","msg","opType","unsubscribe","requestForegroundPermissionsAsync","console","log","getCurrentPositionAsync","location","latitude","coords","longitude","backgroundColor","flex","latitudeDelta","longitudeDelta","map","Company","id","alignItems","marginBottom","fontSize","fontWeight","letterSpacing","paddingBottom","color","length","item"],"sources":["C:/Users/MENO/Desktop/PROJECT/APP-DECO-COLOR/deco-color-driver/src/screens/OrdersScreen/index.js"],"sourcesContent":["import { useRef, useMemo, useState, useEffect } from \"react\";\nimport {\n  View,\n  Text,\n  useWindowDimensions,\n  ActivityIndicator,\n} from \"react-native\";\nimport BottomSheet, { BottomSheetFlatList } from \"@gorhom/bottom-sheet\";\nimport * as Location from \"expo-location\";\nimport OrderItem from \"../../components/OrderItem\";\nimport MapView from \"react-native-maps\";\nimport { DataStore } from \"aws-amplify\";\nimport { Order } from \"../../models\";\nimport CustomMarker from \"../../components/CustomMarker\";\n\nconst OrdersScreen = () => {\n  const [orders, setOrders] = useState([]);\n  const [driverLocation, setDriverLocation] = useState(null);\n\n  const bottomSheetRef = useRef(null);\n  const { width, height } = useWindowDimensions();\n\n  const snapPoints = useMemo(() => [\"12%\", \"95%\"], []);\n\n  const fetchOrders = () => {\n    DataStore.query(Order, (order) =>\n      order.status(\"eq\", \"READY_FOR_PICKUP\")\n    ).then(setOrders);\n  };\n\n  useEffect(() => {\n    fetchOrders();\n\n    const subscription = DataStore.observe(Order).subscribe((msg) => {\n      if (msg.opType === \"UPDATE\") {\n        fetchOrders();\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      let { status } = await Location.requestForegroundPermissionsAsync();\n      if (!status === \"granted\") {\n        console.log(\"Nonono\");\n        return;\n      }\n\n      let location = await Location.getCurrentPositionAsync();\n      setDriverLocation({\n        latitude: location.coords.latitude,\n        longitude: location.coords.longitude,\n      });\n    })();\n  }, []);\n\n  if (!driverLocation) {\n    return <ActivityIndicator size={\"large\"} color=\"gray\" />;\n  }\n\n  return (\n    <View style={{ backgroundColor: \"lightblue\", flex: 1 }}>\n      <MapView\n        style={{\n          height,\n          width,\n        }}\n        showsUserLocation\n        followsUserLocation\n        initialRegion={{\n          latitude: driverLocation.latitude,\n          longitude: driverLocation.longitude,\n          latitudeDelta: 0.07,\n          longitudeDelta: 0.07,\n        }}\n      >\n        {orders.map((order) => (\n          <CustomMarker\n            key={order.id}\n            data={order.Company}\n            type=\"COMPANY\"\n          />\n        ))}\n      </MapView>\n      <BottomSheet ref={bottomSheetRef} snapPoints={snapPoints}>\n        <View style={{ alignItems: \"center\", marginBottom: 30 }}>\n          <Text\n            style={{\n              fontSize: 20,\n              fontWeight: \"600\",\n              letterSpacing: 0.5,\n              paddingBottom: 5,\n            }}\n          >\n            You're Online\n          </Text>\n          <Text style={{ letterSpacing: 0.5, color: \"grey\" }}>\n            Available Orders: {orders.length}\n          </Text>\n        </View>\n        <BottomSheetFlatList\n          data={orders}\n          renderItem={({ item }) => <OrderItem order={item} />}\n        />\n      </BottomSheet>\n    </View>\n  );\n};\n\nexport default OrdersScreen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}